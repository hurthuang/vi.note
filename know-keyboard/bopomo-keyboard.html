<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>認識注音鍵盤(大字+語音)</title>
    <link href="/style.css" rel="stylesheet" type="text/css" media="all">
  </head>
  <body>
<p>
	<span style="font-size:72px;">請按下注音按鍵：</span></p>
<div id="output" style="font-size: 150px; text-align: center; color: blue;">
	&nbsp;</div>
<p>
	選擇語音角色：</p>
<p>
	<select id="voice-select"></select> <script>
      // 創建語音合成器對象
      const synth = window.speechSynthesis;

      // 創建 SpeechRecognition 對象
      const recognition = new window.webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.lang = 'zh-TW'; // 設置語言為中文

      // Bopomofo對照表
      const bopomofo = {
        '1': 'ㄅ',
        'q': 'ㄆ',
        'a': 'ㄇ',
        'z': 'ㄈ',
        '2': 'ㄉ',
        'w': 'ㄊ',
        's': 'ㄋ',
        'x': 'ㄌ',
        '3': 'ˇ',
        'e': 'ㄍ',
        'd': 'ㄎ',
        'c': 'ㄏ',
        '4': 'ˋ',
        'r': 'ㄐ',
        'f': 'ㄑ',
        'v': 'ㄒ',
        '5': 'ㄓ',
        't': 'ㄔ',
        'g': 'ㄕ',
        'b': 'ㄖ',
        '6': 'ˊ',
        'y': 'ㄗ',
        'h': 'ㄘ',
        'n': 'ㄙ',
        '7': '˙',
        'u': 'ㄧ',
        'j': 'ㄨ',
        'm': 'ㄩ',
        '8': 'ㄚ',
        'i': 'ㄛ',
        'k': 'ㄜ',
        ',': 'ㄝ',
        '9': 'ㄞ',
        'o': 'ㄟ',
        'l': 'ㄠ',
        '.': 'ㄡ',
        '0': 'ㄢ',
        'p': 'ㄣ',
        ';': 'ㄤ',
        '/': 'ㄥ',
        '-': 'ㄦ',
      };

      // 語音角色列表
      const voiceSelect = document.getElementById('voice-select');
      let voices = [];

      // 當語音合成器加載完成時，填充語音角色下拉選單
      synth.onvoiceschanged = function() {
        voices = synth.getVoices();
        voices.forEach(function(voice, index) {
          const option = document.createElement('option');
          option.value = index;
          option.text = `${voice.name} (${voice.lang})`;
          voiceSelect.appendChild(option);
        });
      };

      // 綁定 keydown 事件
      document.addEventListener('keydown', function(event) {
        // 顯示按下的按鍵所代表的注音
        const output = document.getElementById('output');
        const key = event.key.toLowerCase();
        if (key in bopomofo) {
          const bopomofoChar = bopomofo[key];
          output.innerHTML = `${bopomofoChar}`;

          // 選擇語音角色
          const selectedVoiceIndex = voiceSelect.value;
          const selectedVoice = voices[selectedVoiceIndex];

          // 使用語音合成器唸出注音
          const utterance = new SpeechSynthesisUtterance(bopomofoChar);
          utterance.voice = selectedVoice;
          synth.speak(utterance);
        } else {
          output.innerHTML = '無注音';
        }
      });
    </script></p>

  </body>
</html>
