<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»¿æ’éŠæˆ²</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .game-settings {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 1em;
            background-color: white;
        }
        .grids-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            flex: 1;
        }
        table {
            border-collapse: collapse;
            margin: 0 auto;
            width: 100%;
        }
        th, td {
            border: 2px solid #ddd;
            text-align: center;
            width: 60px;
            height: 60px;
            font-size: 2em;
            /* ç¢ºä¿ TD ä¸­çš„å…§å®¹ä¸æœƒæ¥æ”¶é»æ“Šäº‹ä»¶ */
            pointer-events: none;
        }
        .player-cell {
            background-color: #e6f7ff;
            cursor: pointer;
            /* é‡è¦ï¼šå•Ÿç”¨ TD çš„é»æ“Šäº‹ä»¶ */
            pointer-events: auto;
        }
        .player-cell:hover {
            background-color: #d6f0ff;
        }
        .target-cell {
            background-color: #f0f0f0;
        }
        .emoji-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .emoji-option {
            font-size: 2em;
            cursor: pointer;
            padding: 5px;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .emoji-option:hover {
            background-color: #f0f0f0;
        }
        .emoji-option.selected {
            border-color: #1890ff;
            background-color: #e6f7ff;
        }
        .clear-option {
            background-color: #ffeeee;
            border: 1px dashed #ffaaaa;
            margin-left: 10px;
        }
        .clear-option.selected {
            background-color: #ffe6e6;
            border-color: #ff4d4f;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .new-game {
            background-color: #1890ff;
            color: white;
        }
        .new-game:hover {
            background-color: #0c7cd5;
        }
        .check-answer {
            background-color: #52c41a;
            color: white;
        }
        .check-answer:hover {
            background-color: #389e0d;
        }
        .reset {
            background-color: #ff4d4f;
            color: white;
        }
        .reset:hover {
            background-color: #cf1322;
        }
        .message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .hidden {
            display: none;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        #customItemsContainer {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        #customItems {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1em;
        }
        .custom-submit {
            background-color: #1890ff;
            color: white;
            margin-top: 10px;
        }
        .custom-submit:hover {
            background-color: #0c7cd5;
        }
    </style>
</head>
<body>
    <h1>ä»¿æ’éŠæˆ²</h1>
    
    <div class="game-container">
        <div class="game-settings">
            <div class="setting-group">
                <label for="category">é¸æ“‡é¡åˆ¥ï¼š</label>
                <select id="category" aria-label="é¸æ“‡éŠæˆ²é¡åˆ¥">
                    <option value="vegetables">è”¬èœ</option>
                    <option value="fruits">æ°´æœ</option>
                    <option value="vehicles">äº¤é€šå·¥å…·</option>
                    <option value="weather">å¤©æ°£</option>
                    <option value="animals">å‹•ç‰©</option>
                    <option value="sports">é‹å‹•</option>
                    <option value="food">é£Ÿç‰©</option>
                    <option value="emotions">è¡¨æƒ…</option>
                    <option value="music">éŸ³æ¨‚</option>
                    <option value="numbers">æ•¸å­—</option>
                    <option value="uppercaseLetters">è‹±æ–‡å¤§å¯«å­—æ¯</option>
                    <option value="lowercaseLetters">è‹±æ–‡å°å¯«å­—æ¯</option>
                    <option value="text1">æ–‡å­—1</option>
                    <option value="text2">æ–‡å­—2</option>
                    <option value="text3">æ–‡å­—3</option>
                    <option value="custom">è‡ªè¨‚</option>
                </select>
            </div>
            <div class="setting-group">
                <label for="itemCount">ç›®æ¨™åœ–æ¡ˆæ•¸é‡ï¼š</label>
                <select id="itemCount" aria-label="é¸æ“‡ç›®æ¨™åœ–æ¡ˆæ•¸é‡">
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8" selected>8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                </select>
            </div>
        </div>

        <div id="customItemsContainer" class="hidden">
            <h3>è‡ªè¨‚é …ç›®</h3>
            <p>è«‹è¼¸å…¥è¦ç”¨æ–¼éŠæˆ²çš„é …ç›®ï¼Œæ¯å€‹é …ç›®ç”¨é€—è™Ÿåˆ†éš”ï¼š</p>
            <textarea id="customItems" placeholder="ä¾‹å¦‚ï¼šè˜‹æœ,æ©˜å­,é¦™è•‰,è‘¡è„,è‰è“" aria-label="è‡ªè¨‚é …ç›®è¼¸å…¥æ¡†"></textarea>
            <button id="submitCustomItems" class="custom-submit">ç¢ºèª</button>
        </div>
        
        <div class="grids-container">
            <div class="section">
                <h2>ç›®æ¨™åœ–æ¡ˆ</h2>
                <table id="target-grid" aria-label="ç›®æ¨™åœ–æ¡ˆè¡¨æ ¼">
                    <caption class="sr-only">è«‹è¨˜ä½é€™äº›åœ–æ¡ˆçš„æ’åˆ—</caption>
                    <tbody>
                        <!-- ç›®æ¨™è¡¨æ ¼å°‡æœƒåœ¨é€™è£¡ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>æ‚¨çš„ç­”æ¡ˆ</h2>
                <table id="player-grid" aria-label="æ‚¨çš„ç­”æ¡ˆå€è¡¨æ ¼">
                    <caption class="sr-only">è«‹åœ¨æ­¤è™•æ”¾ç½®åœ–æ¡ˆä»¥åŒ¹é…ç›®æ¨™åœ–æ¡ˆ</caption>
                    <tbody>
                        <!-- ç©å®¶è¡¨æ ¼å°‡æœƒåœ¨é€™è£¡ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>é¸æ“‡åœ–æ¡ˆ</h2>
            <div id="emoji-selector" class="emoji-selector" aria-label="åœ–æ¡ˆé¸æ“‡å€">
                <!-- åœ–æ¡ˆé¸é …å°‡æœƒåœ¨é€™è£¡ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="controls">
            <button class="new-game" id="new-game">æ–°éŠæˆ²</button>
            <button class="check-answer" id="check-answer">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button class="reset" id="reset">é‡ç½®</button>
            <button class="help" id="help-btn" style="background-color: #8a2be2; color: white;">æ“ä½œèªªæ˜</button>
        </div>
        
        <div id="help-text" class="message hidden" style="background-color: #f0f4ff; border: 1px solid #8a2be2; color: #333; text-align: left; margin-top: 15px; padding: 15px;">
            <h3 style="margin-top: 0;">æ“ä½œèªªæ˜ï¼š</h3>
            <ul style="padding-left: 20px; margin-bottom: 5px; text-align: left;">
                <li>é»æ“Šåº•éƒ¨çš„åœ–æ¡ˆå°‡å…¶é¸ä¸­</li>
                <li>é»æ“Šå³å´è¡¨æ ¼ä¸­çš„ç©ºæ ¼æ”¾ç½®é¸ä¸­çš„åœ–æ¡ˆ</li>
                <li>è¦ç§»é™¤å·²æ”¾ç½®çš„åœ–æ¡ˆï¼Œå…ˆé»æ“Šé¸æ“‡å€çš„æ¸…é™¤ç¬¦è™Ÿ(âŒ)ï¼Œå†é»æ“Šè¦æ¸…é™¤çš„æ ¼å­</li>
                <li>è¦æ›´æ›å·²æ”¾ç½®çš„åœ–æ¡ˆï¼Œå…ˆé¸æ“‡æ–°åœ–æ¡ˆï¼Œå†é»æ“Šè¦æ›´æ›çš„ä½ç½®</li>
                <li>å®Œæˆå¾Œé»æ“Šã€Œæª¢æŸ¥ç­”æ¡ˆã€ç¢ºèªæ˜¯å¦å…¨éƒ¨æ­£ç¢º</li>
            </ul>
        </div>
        
        <div id="message" class="message hidden" aria-live="polite"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å„é¡åˆ¥åœ–æ¡ˆ
            const categoryItems = {
                vegetables: ['ğŸ¥•', 'ğŸ¥”', 'ğŸ†', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ½', 'ğŸ§…', 'ğŸ„', 'ğŸ¥œ', 'ğŸŒ°', 'ğŸ§„', 'ğŸ¥—', 'ğŸ¥™', 'ğŸ¥ª', 'ğŸ¥¯', 'ğŸ ', 'ğŸ¥'],
                fruits: ['ğŸ', 'ğŸŒ', 'ğŸ’', 'ğŸ‡', 'ğŸŠ', 'ğŸ“', 'ğŸ‘', 'ğŸ', 'ğŸ¥‘', 'ğŸ¥', 'ğŸ‰', 'ğŸ‹', 'ğŸˆ', 'ğŸ', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ…'],
                vehicles: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'âœˆï¸', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸ›µ', 'ğŸï¸', 'ğŸš‚', 'ğŸš†'],
                weather: ['â˜€ï¸', 'ğŸŒ¤ï¸', 'â›…', 'ğŸŒ¥ï¸', 'â˜ï¸', 'ğŸŒ¦ï¸', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸŒ©ï¸', 'ğŸŒ¨ï¸', 'â„ï¸', 'ğŸ’¨', 'ğŸŒˆ', 'â˜”', 'âš¡', 'ğŸŒŠ', 'ğŸŒ‹', 'ğŸ”ï¸'],
                animals: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸ™', 'ğŸ', 'ğŸ¦‹', 'ğŸ '],
                sports: ['âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ±', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ¥Š', 'ğŸ³', 'ğŸ‹ï¸', 'ğŸš´', 'ğŸŠ', 'ğŸ„', 'ğŸ®'],
                food: ['ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸŒ­', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸ°', 'ğŸ¦', 'ğŸº', 'ğŸ·', 'ğŸµ', 'â˜•', 'ğŸ¥¤', 'ğŸ´', 'ğŸ¥¢', 'ğŸ¥—', 'ğŸ±'],
                emotions: ['ğŸ˜€', 'ğŸ˜‚', 'ğŸ¥°', 'ğŸ˜', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜´', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ¤¯', 'ğŸ¥³', 'ğŸ˜‡', 'ğŸ™ƒ', 'ğŸ˜¤', 'ğŸ¤’', 'ğŸ¤ ', 'ğŸ¤“', 'ğŸ¤¡'],
                music: ['ğŸ¼', 'ğŸµ', 'ğŸ¶', 'ğŸ¹', 'ğŸ¸', 'ğŸº', 'ğŸ¥', 'ğŸ»', 'ğŸ¨', 'ğŸ–Œï¸', 'ğŸ­', 'ğŸ¬', 'ğŸ“·', 'ğŸ“¸', 'ğŸ¤', 'ğŸ§', 'ğŸ“š', 'ğŸ–Šï¸'],
                numbers: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
                uppercaseLetters: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'],
                lowercaseLetters: ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'],
                text1: ['å›', 'å› ', 'å›º', 'å›°', 'åœˆ', 'åœ‹', 'åœ', 'åœ’', 'åœ“', 'åœ–', 'åœ˜', 'å›', 'å›¡', 'å›«', 'åœƒ', 'åœ‡', 'å›š', 'å››'],
                text2: ['æ± ', 'æ³¥', 'æ³¨', 'æ³“', 'æ´‹', 'æ´²', 'æ´¾', 'æ³‰', 'æ³°', 'æ´', 'æ´ª', 'æ¶Œ', 'æº', 'æ·µ', 'æ½®', 'ç€‘', 'çŒ', 'æ»™'],
                text3: ['æ¾', 'æŸ', 'æŸ¿', 'æŸ³', 'æ¡', 'æ¡‘', 'æ¢…', 'æ¢§', 'æ¢“', 'æ£Ÿ', 'æ¤¿', 'æ¥Š', 'æ¥“', 'æ¦†', 'æ¨º', 'æ©˜', 'æ©™', 'æªœ'],
                custom: []
            };
            
            // éŠæˆ²è®Šæ•¸
            let selectedItem = null;
            let targetGrid = [];
            let playerGrid = Array(16).fill(null);
            let currentCategory = 'vegetables';
            let itemCount = 8;
            
            // DOM å…ƒç´ 
            const targetGridEl = document.getElementById('target-grid');
            const playerGridEl = document.getElementById('player-grid');
            const emojiSelectorEl = document.getElementById('emoji-selector');
            const categorySelect = document.getElementById('category');
            const itemCountSelect = document.getElementById('itemCount');
            const customItemsContainer = document.getElementById('customItemsContainer');
            const customItemsTextarea = document.getElementById('customItems');
            const submitCustomItemsBtn = document.getElementById('submitCustomItems');
            const newGameBtn = document.getElementById('new-game');
            const checkAnswerBtn = document.getElementById('check-answer');
            const resetBtn = document.getElementById('reset');
            const messageEl = document.getElementById('message');
            
            // äº‹ä»¶ç›£è½å™¨
            categorySelect.addEventListener('change', function() {
                currentCategory = this.value;
                if (currentCategory === 'custom') {
                    customItemsContainer.classList.remove('hidden');
                } else {
                    customItemsContainer.classList.add('hidden');
                    initGame();
                }
            });
            
            itemCountSelect.addEventListener('change', function() {
                itemCount = parseInt(this.value);
                initGame();
            });
            
            submitCustomItemsBtn.addEventListener('click', function() {
                const items = customItemsTextarea.value.split(',').map(item => item.trim()).filter(item => item);
                if (items.length < 3) {
                    messageEl.textContent = 'è«‹è‡³å°‘è¼¸å…¥3å€‹é …ç›®';
                    messageEl.classList.remove('hidden', 'success', 'error');
                    messageEl.classList.add('error');
                    return;
                }
                categoryItems.custom = items;
                initGame();
            });
            
            // åˆå§‹åŒ–éŠæˆ²
            function initGame() {
                // æ¸…ç©ºè¡¨æ ¼
                targetGridEl.innerHTML = '';
                playerGridEl.innerHTML = '';
                emojiSelectorEl.innerHTML = '';
                messageEl.classList.add('hidden');
                
                // é‡ç½®é™£åˆ—
                playerGrid = Array(16).fill(null);
                
                // ç²å–ç•¶å‰é¡åˆ¥çš„é …ç›®
                const items = [...categoryItems[currentCategory]];
                
                // å¦‚æœé …ç›®ä¸è¶³ï¼Œé‡è¤‡ä½¿ç”¨ç¾æœ‰é …ç›®ä»¥å¡«æ»¿æ‰€éœ€æ•¸é‡
                while (items.length < itemCount) {
                    items.push(...categoryItems[currentCategory]);
                }
                
                // éš¨æ©Ÿé¸æ“‡é …ç›®
                const shuffledItems = [...items].sort(() => 0.5 - Math.random());
                const gameItems = shuffledItems.slice(0, itemCount);
                
                // ç”Ÿæˆç›®æ¨™ç¶²æ ¼ï¼Œä½¿ç”¨éš¨æ©Ÿé …ç›®
                targetGrid = Array(16).fill(null);
                
                // å‰µå»ºä¸€å€‹æœ‰ 16 å€‹ä½ç½®çš„ç¶²æ ¼ï¼Œä¸¦éš¨æ©Ÿæ”¾ç½®é …ç›®
                const availablePositions = Array.from({length: 16}, (_, i) => i);
                availablePositions.sort(() => 0.5 - Math.random());
                
                for (let i = 0; i < itemCount && i < availablePositions.length; i++) {
                    const position = availablePositions[i];
                    targetGrid[position] = gameItems[i % gameItems.length];
                }
                
                // æ¸²æŸ“ç›®æ¨™è¡¨æ ¼
                for (let row = 0; row < 4; row++) {
                    const tr = document.createElement('tr');
                    for (let col = 0; col < 4; col++) {
                        const td = document.createElement('td');
                        const index = row * 4 + col;
                        td.className = 'target-cell';
                        if (targetGrid[index]) {
                            td.textContent = targetGrid[index];
                            td.setAttribute('aria-label', `ä½ç½® ${row+1} è¡Œ ${col+1} åˆ—ï¼š${targetGrid[index]}`);
                        } else {
                            td.setAttribute('aria-label', `ä½ç½® ${row+1} è¡Œ ${col+1} åˆ—ï¼šç©ºç™½`);
                        }
                        tr.appendChild(td);
                    }
                    targetGridEl.appendChild(tr);
                }
                
                // æ¸²æŸ“ç©å®¶è¡¨æ ¼
                for (let row = 0; row < 4; row++) {
                    const tr = document.createElement('tr');
                    for (let col = 0; col < 4; col++) {
                        const td = document.createElement('td');
                        const index = row * 4 + col;
                        td.className = 'player-cell';
                        td.dataset.index = index;
                        td.dataset.row = row;
                        td.dataset.col = col;
                        td.setAttribute('aria-label', `ä½ç½® ${row+1} è¡Œ ${col+1} åˆ—ï¼šè«‹é»æ“Šæ­¤è™•æ”¾ç½®é¸å®šçš„åœ–æ¡ˆ`);
                        td.tabIndex = 0; // ä½¿å…¶å¯ä»¥ä½¿ç”¨éµç›¤èšç„¦
                        td.addEventListener('click', handleCellClick);
                        td.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                handleCellClick(e);
                            }
                        });
                        tr.appendChild(td);
                    }
                    playerGridEl.appendChild(tr);
                }
                
                // ç²å–ç›®æ¨™ç¶²æ ¼ä¸­çš„å”¯ä¸€é …ç›®
                const uniqueItems = [...new Set(targetGrid.filter(item => item !== null))];
                
                // éš¨æ©Ÿæ’åˆ—é¸æ“‡å™¨ä¸­çš„é …ç›®
                const shuffledUniqueItems = [...uniqueItems].sort(() => 0.5 - Math.random());
                
                // æ¸²æŸ“é …ç›®é¸æ“‡å™¨
                shuffledUniqueItems.forEach(item => {
                    const itemOption = document.createElement('div');
                    itemOption.className = 'emoji-option';
                    itemOption.textContent = item;
                    itemOption.setAttribute('aria-label', `é¸æ“‡åœ–æ¡ˆ ${item}`);
                    itemOption.tabIndex = 0; // ä½¿å…¶å¯ä»¥ä½¿ç”¨éµç›¤èšç„¦
                    itemOption.addEventListener('click', () => handleItemSelect(item));
                    itemOption.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            handleItemSelect(item);
                        }
                    });
                    emojiSelectorEl.appendChild(itemOption);
                });
                
                // æ·»åŠ æ¸…é™¤é¸é …
                const clearOption = document.createElement('div');
                clearOption.className = 'emoji-option clear-option';
                clearOption.textContent = 'âŒ';
                clearOption.setAttribute('aria-label', 'é¸æ“‡æ¸…é™¤åŠŸèƒ½');
                clearOption.setAttribute('title', 'é¸æ“‡å¾Œé»æ“Šæ ¼å­å¯æ¸…é™¤å…§å®¹');
                clearOption.tabIndex = 0;
                clearOption.addEventListener('click', () => handleItemSelect('CLEAR_MARKER'));
                clearOption.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        handleItemSelect('CLEAR_MARKER');
                    }
                });
                emojiSelectorEl.appendChild(clearOption);
            }
            
            // è™•ç†é …ç›®é¸æ“‡
            function handleItemSelect(item) {
                selectedItem = item;
                
                // æ›´æ–° UI é¡¯ç¤ºé¸å®šçš„é …ç›®
                document.querySelectorAll('.emoji-option').forEach(el => {
                    el.classList.remove('selected');
                    el.setAttribute('aria-pressed', 'false');
                    if (el.textContent === item) {
                        el.classList.add('selected');
                        el.setAttribute('aria-pressed', 'true');
                        // å®£å‘Šå·²é¸å®šçš„é …ç›®ï¼Œä¾›è¢å¹•é–±è®€å™¨ä½¿ç”¨
                        messageEl.textContent = `å·²é¸å®š ${item}ï¼Œè«‹é»æ“Šè¡¨æ ¼ä½ç½®æ”¾ç½®å®ƒ`;
                        messageEl.classList.remove('hidden', 'success', 'error');
                        setTimeout(() => {
                            messageEl.classList.add('hidden');
                        }, 3000);
                    }
                });
            }
            
            // è™•ç†ç©å®¶è¡¨æ ¼ä¸­çš„é›™æ“Šæ¸…é™¤
            function handleCellDoubleClick(e) {
                // ç¢ºä¿æˆ‘å€‘è™•ç†çš„æ˜¯tdå…ƒç´ 
                let cell = e.target;
                if (cell.nodeName !== 'TD') {
                    cell = cell.closest('td');
                    if (!cell) return;
                }
                
                const index = parseInt(cell.dataset.index);
                const row = parseInt(cell.dataset.row) + 1;
                const col = parseInt(cell.dataset.col) + 1;
                
                // å¦‚æœå–®å…ƒæ ¼æœ‰å…§å®¹ï¼Œæ¸…é™¤å®ƒ
                if (cell.textContent) {
                    playerGrid[index] = null;
                    cell.textContent = '';
                    cell.setAttribute('aria-label', `ä½ç½® ${row} è¡Œ ${col} åˆ—ï¼šå·²æ¸…é™¤ï¼Œè«‹é»æ“Šæ­¤è™•æ”¾ç½®åœ–æ¡ˆ`);
                    messageEl.textContent = `å·²æ¸…é™¤ä½ç½® ${row} è¡Œ ${col} åˆ—çš„åœ–æ¡ˆ`;
                    messageEl.classList.remove('hidden', 'success', 'error');
                    setTimeout(() => {
                        messageEl.classList.add('hidden');
                    }, 2000);
                }
            }
            
            // è™•ç†ç©å®¶è¡¨æ ¼ä¸­çš„å–®å…ƒæ ¼é»æ“Š
            function handleCellClick(e) {
                // ç¢ºä¿æˆ‘å€‘è™•ç†çš„æ˜¯tdå…ƒç´ 
                let cell = e.target;
                if (cell.nodeName !== 'TD') {
                    cell = cell.closest('td');
                    if (!cell) return;
                }
                
                const index = parseInt(cell.dataset.index);
                const row = parseInt(cell.dataset.row) + 1;
                const col = parseInt(cell.dataset.col) + 1;
                
                // å¦‚æœæ²’æœ‰é¸æ“‡åœ–æ¡ˆï¼Œæç¤ºç”¨æˆ¶
                if (!selectedItem) {
                    messageEl.textContent = 'è«‹å…ˆé¸æ“‡ä¸€å€‹åœ–æ¡ˆæˆ–æ¸…é™¤åŠŸèƒ½(âŒ)ï¼Œå†é»æ“Šè¡¨æ ¼ä½ç½®';
                    messageEl.classList.remove('hidden', 'success', 'error');
                    setTimeout(() => {
                        messageEl.classList.add('hidden');
                    }, 3000);
                    return;
                }
                
                // å¦‚æœé¸ä¸­äº†æ¸…é™¤æ¨™è¨˜
                if (selectedItem === 'CLEAR_MARKER') {
                    if (cell.textContent) {
                        playerGrid[index] = null;
                        cell.textContent = '';
                        cell.setAttribute('aria-label', `ä½ç½® ${row} è¡Œ ${col} åˆ—ï¼šå·²æ¸…é™¤ï¼Œè«‹é»æ“Šæ­¤è™•æ”¾ç½®åœ–æ¡ˆ`);
                        messageEl.textContent = `å·²æ¸…é™¤ä½ç½® ${row} è¡Œ ${col} åˆ—çš„åœ–æ¡ˆ`;
                        messageEl.classList.remove('hidden', 'success', 'error');
                        setTimeout(() => {
                            messageEl.classList.add('hidden');
                        }, 2000);
                    }
                    return;
                }
                
                // æ”¾ç½®æ–°åœ–æ¡ˆ
                playerGrid[index] = selectedItem;
                cell.textContent = selectedItem;
                cell.setAttribute('aria-label', `ä½ç½® ${row} è¡Œ ${col} åˆ—ï¼š${selectedItem}`);
            }
            
            // æª¢æŸ¥ç©å®¶çš„ç­”æ¡ˆæ˜¯å¦èˆ‡ç›®æ¨™ç›¸ç¬¦
            function checkAnswer() {
                let correct = true;
                
                for (let i = 0; i < 16; i++) {
                    if (targetGrid[i] !== playerGrid[i]) {
                        correct = false;
                        break;
                    }
                }
                
                // é¡¯ç¤ºçµæœæ¶ˆæ¯
                messageEl.classList.remove('hidden', 'success', 'error');
                if (correct) {
                    messageEl.textContent = 'æ­å–œï¼æ‚¨æˆåŠŸè¤‡è£½äº†ç›®æ¨™åœ–æ¡ˆï¼';
                    messageEl.classList.add('success');
                } else {
                    messageEl.textContent = 'é‚„æ²’å®Œæˆï¼Œè«‹ç¹¼çºŒå˜—è©¦ï¼';
                    messageEl.classList.add('error');
                }
            }
            
            // é‡ç½®ç©å®¶çš„è¡¨æ ¼
            function resetGrid() {
                playerGrid = Array(16).fill(null);
                document.querySelectorAll('.player-cell').forEach(cell => {
                    cell.textContent = '';
                    const row = parseInt(cell.dataset.row) + 1;
                    const col = parseInt(cell.dataset.col) + 1;
                    cell.setAttribute('aria-label', `ä½ç½® ${row} è¡Œ ${col} åˆ—ï¼šè«‹é»æ“Šæ­¤è™•æ”¾ç½®é¸å®šçš„åœ–æ¡ˆ`);
                });
                messageEl.classList.add('hidden');
                
                // æ¸…é™¤é …ç›®é¸æ“‡
                selectedItem = null;
                document.querySelectorAll('.emoji-option').forEach(el => {
                    el.classList.remove('selected');
                    el.setAttribute('aria-pressed', 'false');
                });
            }
            
            // æŒ‰éˆ•çš„äº‹ä»¶ç›£è½å™¨
            newGameBtn.addEventListener('click', initGame);
            checkAnswerBtn.addEventListener('click', checkAnswer);
            resetBtn.addEventListener('click', resetGrid);
            
            // æ“ä½œèªªæ˜æŒ‰éˆ•
            const helpBtn = document.getElementById('help-btn');
            const helpText = document.getElementById('help-text');
            
            helpBtn.addEventListener('click', function() {
                if (helpText.classList.contains('hidden')) {
                    helpText.classList.remove('hidden');
                    helpBtn.textContent = 'éš±è—èªªæ˜';
                } else {
                    helpText.classList.add('hidden');
                    helpBtn.textContent = 'æ“ä½œèªªæ˜';
                }
            });
            
            // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–éŠæˆ²
            initGame();
        });
    </script>
</body>
</html>