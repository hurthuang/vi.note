<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>3-mountains task</title>
    <style>
        body {
            font-family: "微軟正黑體", sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        table {
            border-collapse: collapse;
            margin: 20px auto;
        }
        td {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 20px;
            vertical-align: middle;
        }
        .question-container {
            margin: 30px 0;
        }
        .options {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }
        .option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .option:hover {
            background-color: #f5f5f5;
        }
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .next-btn {
            background-color: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: none;
        }
        .result {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .correct {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
        }
    </style>
</head>
<body>
    <h1>3-mountains task</h1>
    
    <table>
        <tr>
            <td>↘</td>
            <td></td>
            <td>↓</td>
            <td></td>
            <td>↙</td>
        </tr>
        <tr>
            <td></td>
            <td>▲</td>
            <td>x</td>
            <td>x</td>
            <td></td>
        </tr>
        <tr>
            <td>→</td>
            <td>x</td>
            <td>x</td>
            <td>●</td>
            <td>←</td>
        </tr>
        <tr>
            <td></td>
            <td>x</td>
            <td>◼️</td>
            <td>x</td>
            <td></td>
        </tr>
        <tr>
            <td>↗</td>
            <td></td>
            <td>↑</td>
            <td></td>
            <td>↖</td>
        </tr>
    </table>

    <div class="question-container">
        <h3>題目方向：<span id="current-direction">↑</span></h3>
        <p>從此方向看，由左至右的排列順序是什麼？</p>
        <div id="options" class="options">
            <!-- 選項會由JavaScript動態生成 -->
        </div>
    </div>

    <div id="result" class="result"></div>

    <div class="button-container">
        <button type="submit" id="submit-btn" class="submit-btn" onclick="checkAnswer()">繳交答案</button>
        <button type="button" id="next-btn" class="next-btn" onclick="nextQuestion()">下一題</button>
    </div>

    <script>
        // 正向視角的答案對照
        const fullDirectionAnswers = {
            '↑': '▲,◼️,●',   // 從下方往上看
            '↓': '●,◼️,▲',   // 從上方往下看
            '→': '▲,●,◼️',   // 從左往右看
            '←': '◼️,●,▲'    // 從右往左看
        };

        // 斜向視角答案
        const diagonalAnswers = {
            '↗': ['▲,◼️'],        // ● 被 ◼️ 擋住
            '↖': ['◼️,▲,●'],      // 沒有被擋住
            '↘': ['●,▲,◼️'],      // 沒有被擋住
            '↙': ['●,▲'],        // ▲ 被 ● 擋住
        };
        
        const directions = ['↑', '↓', '→', '←', '↖', '↗', '↙', '↘'];
        let currentDirection = '';

        function generateOptions(direction) {
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            let options = [
                '▲,◼️,●', '●,◼️,▲', '▲,●,◼️',
                '◼️,●,▲', '◼️,▲,●', '●,▲,◼️'
            ];

            if (!(direction in fullDirectionAnswers)) {
                // 對於斜向視角，添加兩物件的選項
                options = options.concat([
                    '▲,◼️', '◼️,●', '●,▲',
                    '▲,●', '◼️,▲', '●,◼️'
                ]);
            }

            // 隨機打亂選項順序
            options.sort(() => Math.random() - 0.5);

            options.forEach((option, index) => {
                const label = document.createElement('label');
                label.className = 'option';
                label.innerHTML = `
                    <input type="radio" name="answer" value="${index}">
                    <span>${option}</span>
                `;
                optionsContainer.appendChild(label);
            });
        }

        function checkAnswer() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submit-btn');
            const nextBtn = document.getElementById('next-btn');

            if (!selectedAnswer) {
                alert('請選擇一個答案');
                return;
            }

            const selectedText = selectedAnswer.parentElement.querySelector('span').textContent;
            let isCorrect = false;

            if (currentDirection in fullDirectionAnswers) {
                isCorrect = selectedText === fullDirectionAnswers[currentDirection];
            } else {
                isCorrect = diagonalAnswers[currentDirection].includes(selectedText);
            }
            
            resultDiv.style.display = 'block';
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'inline-block';

            if (isCorrect) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = '答案正確！';
            } else {
                resultDiv.className = 'result incorrect';
                let correctAnswer = currentDirection in fullDirectionAnswers ? 
                    fullDirectionAnswers[currentDirection] :
                    diagonalAnswers[currentDirection].join(' 或 ');
                resultDiv.textContent = `答案錯誤，正確答案是：${correctAnswer}`;
            }
        }

        function randomDirection() {
            const randomIndex = Math.floor(Math.random() * directions.length);
            const direction = directions[randomIndex];
            document.getElementById('current-direction').textContent = direction;
            generateOptions(direction);
            return direction;
        }

        function nextQuestion() {
            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submit-btn');
            const nextBtn = document.getElementById('next-btn');

            resultDiv.style.display = 'none';
            submitBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';

            currentDirection = randomDirection();
        }

        // 初始化第一題
        currentDirection = randomDirection();
    </script>
</body>
</html>