<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #content {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            min-height: 200px;
            white-space: pre-wrap;
        }
        .control-panel {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        select, input[type="range"] {
            min-width: 120px;
        }
        .button-group {
            margin: 10px 0;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            cursor: pointer;
        }
        .reading {
            background-color: #ffeb3b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>文字閱讀器</h2>
        <textarea id="textInput" placeholder="請輸入文字..." rows="5" style="width: 100%"></textarea>
        <br>
        <input type="file" id="fileInput" accept=".txt">
        <div class="control-panel">
            <div class="control-item">
                <label>語音:</label>
                <select id="voiceSelect"></select>
            </div>
            <div class="control-item">
                <label>速度:</label>
                <input type="range" id="rateSlider" min="0.5" max="5" step="0.5" value="1">
                <span id="rateValue">1.0</span>
            </div>
            <div class="control-item">
                <label>音調:</label>
                <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1">
                <span id="pitchValue">1.0</span>
            </div>
            <div class="control-item">
                <label>文字大小:</label>
                <input type="range" id="sizeSlider" min="12" max="150" value="16">
                <span id="sizeValue">16px</span>
            </div>
        </div>
        <div class="button-group">
            <button id="readAllBtn">朗讀全部</button>
            <button id="pauseBtn" disabled>暫停</button>
            <button id="resumeBtn" disabled>繼續</button>
            <button id="stopBtn" disabled>停止</button>
        </div>
        <div id="content" style="font-size: 16px"></div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const content = document.getElementById('content');
        const fileInput = document.getElementById('fileInput');
        const sizeSlider = document.getElementById('sizeSlider');
        const sizeValue = document.getElementById('sizeValue');
        const voiceSelect = document.getElementById('voiceSelect');
        const rateSlider = document.getElementById('rateSlider');
        const pitchSlider = document.getElementById('pitchSlider');
        const rateValue = document.getElementById('rateValue');
        const pitchValue = document.getElementById('pitchValue');
        const readAllBtn = document.getElementById('readAllBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const synth = window.speechSynthesis;

        let isReading = false;

        function loadVoices() {
            const voices = synth.getVoices();
            voiceSelect.innerHTML = voices
                .filter(voice => voice.lang.includes('zh'))
                .map(voice => `<option value="${voice.name}">${voice.name} (${voice.lang})</option>`)
                .join('');
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        loadVoices();

        function updateButtons(reading) {
            readAllBtn.disabled = reading;
            pauseBtn.disabled = !reading;
            resumeBtn.disabled = true;
            stopBtn.disabled = !reading;
            isReading = reading;
            content.classList.toggle('reading', reading);
        }

        function createUtterance(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = synth.getVoices();
            utterance.voice = voices.find(voice => voice.name === voiceSelect.value);
            utterance.rate = parseFloat(rateSlider.value);
            utterance.pitch = parseFloat(pitchSlider.value);
            return utterance;
        }

        textInput.addEventListener('input', () => {
            content.textContent = textInput.value;
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                const text = event.target.result;
                textInput.value = text;
                content.textContent = text;
            };
            reader.readAsText(file);
        });

        sizeSlider.addEventListener('input', () => {
            const size = sizeSlider.value;
            content.style.fontSize = `${size}px`;
            sizeValue.textContent = `${size}px`;
        });

        rateSlider.addEventListener('input', () => {
            rateValue.textContent = rateSlider.value;
        });

        pitchSlider.addEventListener('input', () => {
            pitchValue.textContent = pitchSlider.value;
        });

        content.addEventListener('click', (e) => {
            if (e.target === content) {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();
                
                if (selectedText) {
                    synth.cancel();
                    updateButtons(false);
                    const utterance = createUtterance(selectedText);
                    synth.speak(utterance);
                }
            }
        });

        readAllBtn.addEventListener('click', () => {
            const text = content.textContent;
            if (text) {
                synth.cancel();
                const utterance = createUtterance(text);
                utterance.onend = () => updateButtons(false);
                updateButtons(true);
                synth.speak(utterance);
            }
        });

        pauseBtn.addEventListener('click', () => {
            if (synth.speaking) {
                synth.pause();
                pauseBtn.disabled = true;
                resumeBtn.disabled = false;
            }
        });

        resumeBtn.addEventListener('click', () => {
            if (synth.paused) {
                synth.resume();
                pauseBtn.disabled = false;
                resumeBtn.disabled = true;
            }
        });

        stopBtn.addEventListener('click', () => {
            synth.cancel();
            updateButtons(false);
        });
    </script>
</body>
</html>
