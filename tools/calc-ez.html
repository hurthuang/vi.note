<!DOCTYPE html>
<html lang="zh-TW">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>標準計算機</title>
	<style>
	       body {
	           font-family: Arial, sans-serif;
	           display: flex;
	           justify-content: center;
	           align-items: center;
	           height: 100vh;
	           margin: 0;
	           background-color: #f0f0f0;
	       }
	       .calculator {
	           background-color: #fff;
	           border-radius: 10px;
	           box-shadow: 0 0 10px rgba(0,0,0,0.1);
	           padding: 20px;
	           width: 300px;
	       }
	       #display {
	           width: 100%;
	           height: 50px;
	           font-size: 24px;
	           text-align: right;
	           margin-bottom: 10px;
	           padding: 5px;
	           box-sizing: border-box;
	       }
	       .buttons {
	           display: grid;
	           grid-template-columns: repeat(4, 1fr);
	           gap: 10px;
	       }
	       button {
	           width: 100%;
	           height: 50px;
	           font-size: 20px;
	           border: none;
	           border-radius: 5px;
	           cursor: pointer;
	           background-color: #e0e0e0;
	           transition: background-color 0.3s;
	           position: relative;
	       }
	       button:hover {
	           opacity: 0.8;
	       }
	       button[data-key]::after {
	           content: attr(data-key);
	           font-size: 12px;
	           position: absolute;
	           bottom: 5px;
	           right: 5px;
	           color: var(--key-color, #666);
	       }
	       .controls {
	           display: flex;
	           justify-content: space-between;
	           align-items: center;
	           margin-top: 10px;
	           font-size: 14px;
	       }
	       .switch, .color-picker, .font-size-slider {
	           display: flex;
	           align-items: center;
	       }
	       .switch label, .color-picker label, .font-size-slider label {
	           margin-right: 5px;
	       }
	       .color-picker input[type="color"] {
	           width: 30px;
	           height: 30px;
	           padding: 0;
	           border: none;
	       }
	       .font-size-slider input[type="range"] {
	           width: 80px;
	           margin-right: 5px;
	       }
	       #fontSizeValue {
	           width: 40px;
	       }
	</style>
</head>
<body>
	<div class="calculator">
		<input id="display" readonly type="text">
		<div class="buttons">
			<button data-key="7" onclick="appendToDisplay('7')">7</button> <button data-key="8" onclick="appendToDisplay('8')">8</button> <button data-key="9" onclick="appendToDisplay('9')">9</button> <button data-key="+" onclick="appendToDisplay('+')">+</button> <button data-key="4" onclick="appendToDisplay('4')">4</button> <button data-key="5" onclick="appendToDisplay('5')">5</button> <button data-key="6" onclick="appendToDisplay('6')">6</button> <button data-key="-" onclick="appendToDisplay('-')">-</button> <button data-key="1" onclick="appendToDisplay('1')">1</button> <button data-key="2" onclick="appendToDisplay('2')">2</button> <button data-key="3" onclick="appendToDisplay('3')">3</button> <button data-key="x" onclick="appendToDisplay('×')">×</button> <button data-key="0" onclick="appendToDisplay('0')">0</button> <button data-key="." onclick="appendToDisplay('.')">.</button> <button data-key="enter" onclick="calculate()">=</button> <button data-key="/" onclick="appendToDisplay('÷')">÷</button> <button data-key="esc" onclick="clearDisplay()">C</button> <button data-key="backspace" onclick="backspace()">←</button> <button data-key="r" onclick="repeatLastResult()">重複</button> <button data-key="n" onclick="appendToDisplay('n')">+/-</button> <button data-key="s" onclick="square()">x²</button> <button data-key="c" onclick="cube()">x³</button> <button data-key="q" onclick="squareRoot()">√</button> <button data-key="%" onclick="percent()">%</button>
		</div>
		<div class="switch">
			<label><input checked id="speechToggle" type="checkbox"> 語音</label>
		</div>
		<div class="controls">
			<div class="color-picker">
				<label for="textColor">文字</label> <input id="textColor" type="color" value="#000000">
			</div>
			<div class="color-picker">
				<label for="bgColor">背景</label> <input id="bgColor" type="color" value="#e0e0e0">
			</div>
			<div class="font-size-slider">
				<label for="fontSize">字體</label> <input id="fontSize" max="36" min="20" type="range" value="20"> <span id="fontSizeValue">20px</span>
			</div>
		</div>
		<script>
		      let display = document.getElementById('display');
		      let speechSynthesis = window.speechSynthesis;
		      let lastResult = '';

		      function appendToDisplay(value) {
		          stopSpeaking();
		          if (value === 'n') {
		              toggleNegative();
		          } else {
		              display.value += value;
		              speak(getSpokenValue(value));
		          }
		      }

		      function getSpokenValue(value) {
		          switch(value) {
		              case '×': return '成以';
		              case '÷': return '除以';
		              case '-': return '減';
		              default: return value;
		          }
		      }

		      function clearDisplay() {
		          stopSpeaking();
		          display.value = '';
		          speak('清除');
		      }

		      function backspace() {
		          stopSpeaking();
		          display.value = display.value.slice(0, -1);
		          speak('退格');
		      }

		      function calculate() {
		          stopSpeaking();
		          try {
		              let expression = display.value.replace(/×/g, '*').replace(/÷/g, '/');
		              let result = eval(expression);
		              lastResult = `${formatExpressionForSpeech(display.value)} 等於 ${formatNumberForSpeech(result)}`;
		              display.value = result;
		              speak(lastResult);
		          } catch (error) {
		              display.value = '錯誤';
		              speak('計算錯誤');
		          }
		      }

		      function formatExpressionForSpeech(expr) {
		          return expr.replace(/×/g, '成以')
		                     .replace(/÷/g, '除以')
		                     .replace(/-/g, '減')
		                     .replace(/(?<!\d)-(\d+)/g, (_, num) => `負${num}`)
		                     .replace(/(\d+(\.\d+)?)/g, (match) => formatNumberForSpeech(parseFloat(match)));
		      }

		      function formatNumberForSpeech(num) {
		          if (num < 0) {
		              return `負${Math.abs(num)}`;
		          }
		          return num.toString();
		      }

		      function toggleNegative() {
		          stopSpeaking();
		          let currentValue = display.value;
		          let lastNumber = currentValue.match(/-?\d+(\.\d+)?$/);
		          if (lastNumber) {
		              let index = currentValue.lastIndexOf(lastNumber[0]);
		              let prefix = currentValue.substring(0, index);
		              let number = parseFloat(lastNumber[0]);
		              let newNumber = -number;
		              display.value = prefix + newNumber;
		              speak('切換正負號');
		          } else if (currentValue === '' || currentValue.endsWith('+') || currentValue.endsWith('-') || currentValue.endsWith('×') || currentValue.endsWith('÷')) {
		              display.value += '(-';
		              speak('負');
		          }
		      }

		      function repeatLastResult() {
		          stopSpeaking();
		          speak(lastResult || '沒有上一次的計算結果');
		      }

		      function square() {
		          stopSpeaking();
		          let value = parseFloat(display.value);
		          if (!isNaN(value)) {
		              let result = value * value;
		              lastResult = `${formatNumberForSpeech(value)} 的平方等於 ${formatNumberForSpeech(result)}`;
		              display.value = result;
		              speak(lastResult);
		          }
		      }

		      function cube() {
		          stopSpeaking();
		          let value = parseFloat(display.value);
		          if (!isNaN(value)) {
		              let result = value * value * value;
		              lastResult = `${formatNumberForSpeech(value)} 的立方等於 ${formatNumberForSpeech(result)}`;
		              display.value = result;
		              speak(lastResult);
		          }
		      }

		      function squareRoot() {
		          stopSpeaking();
		          let value = parseFloat(display.value);
		          if (!isNaN(value) && value >= 0) {
		              let result = Math.sqrt(value);
		              lastResult = `${formatNumberForSpeech(value)} 的平方根等於 ${formatNumberForSpeech(result)}`;
		              display.value = result;
		              speak(lastResult);
		          } else {
		              display.value = '錯誤';
		              speak('無法計算負數的平方根');
		          }
		      }

		      function percent() {
		          stopSpeaking();
		          let value = parseFloat(display.value);
		          if (!isNaN(value)) {
		              let result = value / 100;
		              lastResult = `${formatNumberForSpeech(value)} 的百分比等於 ${formatNumberForSpeech(result)}`;
		              display.value = result;
		              speak(lastResult);
		          }
		      }

		      function speak(text) {
		          if (document.getElementById('speechToggle').checked) {
		              let utterance = new SpeechSynthesisUtterance(text);
		              utterance.lang = 'zh-TW';
		              speechSynthesis.speak(utterance);
		          }
		      }

		      function stopSpeaking() {
		          speechSynthesis.cancel();
		      }

		      document.addEventListener('keydown', function(event) {
		          let key = event.key.toLowerCase();
		          if (key === 'escape') key = 'esc';
		          if (key === '*') key = 'x';
		          let button = document.querySelector(`button[data-key="${key}"]`);
		          if (button) {
		              event.preventDefault();
		              button.click();
		          }
		      });

		      let buttons = document.querySelectorAll('button');
		      buttons.forEach(button => {
		          button.addEventListener('mouseenter', function() {
		              let key = this.getAttribute('data-key');
		              if (key) {
		                  this.title = `快速鍵: ${key}`;
		              }
		          });
		      });

		      // 顏色調整功能
		      const textColorPicker = document.getElementById('textColor');
		      const bgColorPicker = document.getElementById('bgColor');

		      function updateButtonColors() {
		          const textColor = textColorPicker.value;
		          const bgColor = bgColorPicker.value;

		          buttons.forEach(button => {
		              button.style.color = textColor;
		              button.style.backgroundColor = bgColor;
		              button.style.setProperty('--key-color', textColor);
		          });
		      }

		      textColorPicker.addEventListener('input', updateButtonColors);
		      bgColorPicker.addEventListener('input', updateButtonColors);

		      // 字體大小調整功能
		      const fontSizeSlider = document.getElementById('fontSize');
		      const fontSizeValue = document.getElementById('fontSizeValue');

		      function updateFontSize() {
		          const fontSize = fontSizeSlider.value;
		          fontSizeValue.textContent = `${fontSize}px`;

		          buttons.forEach(button => {
		              button.style.fontSize = `${fontSize}px`;
		          });

		          display.style.fontSize = `${fontSize}px`;
		      }

		      fontSizeSlider.addEventListener('input', updateFontSize);

		      // 初始化顏色和字體大小
		      updateButtonColors();
		      updateFontSize();
		</script> 
	</div>
</body>
</html>