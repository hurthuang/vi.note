<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UEB 縮寫點字字典</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 40px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 6px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        .search-input:focus {
            outline: none;
            border-color: #4a90e2;
        }
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        .mode-indicator {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            background: #f0f0f0;
            color: #666;
        }
        .mode-active {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .category-select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin-bottom: 20px;
            background-color: white;
        }
        .help-text {
            margin: 8px 0;
            color: #666;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        th:hover {
            background-color: #e9ecef;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .sort-icon {
            display: inline-block;
            width: 0;
            height: 0;
            margin-left: 5px;
            vertical-align: middle;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
        }
        .sort-asc {
            border-bottom: 4px solid #333;
        }
        .sort-desc {
            border-top: 4px solid #333;
        }
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        kbd {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div class="container">
	<h1>
		UEB 縮寫表查詢器</h1>
	<div class="search-container">
		<svg class="search-icon" fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16"> <circle cx="11" cy="11" r="8"></circle> <line x1="21" x2="16.65" y1="21" y2="16.65"></line> </svg> <input autocomplete="off" class="search-input" id="search-input" placeholder="搜尋點字符號、英文或類型..." type="text" />
		<div class="mode-indicator" id="mode-indicator">
			一般模式</div>
	</div>
	<div class="help-text">
		按 <kbd>Ctrl</kbd> + <kbd>B</kbd> 切換點字輸入模式， 使用 <kbd>S</kbd><kbd>D</kbd><kbd>F</kbd> 和 <kbd>J</kbd><kbd>K</kbd><kbd>L</kbd> 輸入點字</div>
	<select class="category-select" id="category-select"><option value="">所有類別</option></select>
	<div id="table-container">
		<table>
			<thead>
				<tr>
					<th data-sort="category">
						類別</th>
					<th data-sort="braille">
						點字符號</th>
					<th data-sort="english">
						英文</th>
					<th data-sort="type">
						類型</th>
				</tr>
			</thead>
			<tbody id="table-body">
			</tbody>
		</table>
	</div>
</div>
<script>
        // 處理資料的函數
        function processDataToCategories(rawText) {
            const categories = {};
            let currentCategory = null;
            let currentTitle = '';

            // 按行分割並處理
            rawText.trim().split('\n').forEach(line => {
                line = line.trim();
                
                // 跳過空行
                if (!line) {
                    return;
                }

                // 檢查是否是類別標題行（例如 "⠁ a"）
                if (line.includes(' ') && line.split(/\s+/).length === 2 && !line.includes('\t')) {
                    currentTitle = line;
                    currentCategory = line.split(' ')[0];  // 使用點字符號作為key
                    categories[currentCategory] = {
                        title: currentTitle,
                        data: []
                    };
                    return;
                }

                // 如果是資料行
                if (currentCategory) {
                    const parts = line.split('\t').map(part => part.trim());
                    
                    // 處理資料行
                    if (parts.length >= 1) {
                        const item = {
                            braille: parts[0],
                            english: parts[1] || '',
                            type: parts[2] || ''
                        };
                        categories[currentCategory].data.push(item);
                    }
                }
            });

            return categories;
        }

        // 測試資料
        const rawData = `
⠁ a		
⠁	a	單字
⠁⠃	about	字母縮寫
⠁⠃⠧	above	字母縮寫
⠁⠉	according	字母縮寫
⠁⠉⠗	across	字母縮寫

⠃ b		
⠃	but	單字縮寫
⠃⠇	blind	字母縮寫
⠃⠗⠇	braille	字母縮寫
⠆	be/bb	下位縮寫
⠆⠉	because	字母縮寫
⠆⠋	before	字母縮寫
⠆⠓	behind	字母縮寫
⠆⠇	below	字母縮寫
⠆⠝	beneath	字母縮寫
⠆⠎	beside	字母縮寫
⠆⠞	between	字母縮寫
⠆⠽	beyond	字母縮寫

⠉ c		
⠉	can	單字縮寫
⠉⠙	could	字母縮寫
⠒	con/cc	下位縮寫
⠒⠉⠧	conceive	字母縮寫
⠒⠉⠧⠛	conceiving	字母縮寫
⠸⠉	cannot	點加字首

⠙ d		
⠙	do	單字縮寫
⠲	dis	下位縮寫
⠙⠉⠇	declare	字母縮寫
⠙⠉⠇⠛	declaring	字母縮寫
⠙⠉⠧	deceive	字母縮寫
⠙⠉⠧⠛	deceiving	字母縮寫
⠐⠙	day	點加字首
⠨⠙	ound	字尾縮寫

⠑ e		
⠑	every	單字縮寫
⠐⠑	ever	點加字首
⠨⠑	ance	字尾縮寫
⠰⠑	ence	字尾縮寫
⠑⠊	either	字母縮寫
⠢	en/enough	下位縮寫

⠋ f		
⠋	from	單字縮寫
⠖	ff	下位縮寫
⠋⠌	first	字母縮寫
⠋⠗	friend	字母縮寫
⠐⠋	father	點加字首

⠛ g		
⠛	go	單字縮寫
⠛⠙	good	字母縮寫
⠛⠗⠞	great	字母縮寫
⠰⠛	ong	字尾縮寫
⠶	gg/were	下位縮寫

⠓ h		
⠓	have	單字縮寫
⠓⠍	him	字母縮寫
⠓⠍⠋	himself	字母縮寫
⠸⠓	had	點加字首
⠐⠓	here	點加字首

⠊ i		
⠊⠍⠍	immediate	字母縮寫
⠔	in	下位縮寫

⠅ k		
⠅	knowledge	單字縮寫
⠐⠅	know	點加字首

⠇ l		
⠇	like	單字縮寫
⠇⠇	little	字母縮寫
⠇⠗	letter	字母縮寫
⠰⠇	ful	字尾縮寫
⠐⠇	lord	點加字首

⠍ m		
⠍	more	單字縮寫
⠍⠡	much	字母縮寫
⠍⠌	must	字母縮寫
⠍⠽⠋	myself	字母縮寫
⠸⠍	many	點加字首
⠐⠍	mother	點加字首

⠝ n		
⠝	not	單字縮寫
⠝⠑⠉	necessary	字母縮寫
⠝⠑⠊	neither	字母縮寫
⠨⠝	sion	字尾縮寫
⠰⠝	tion	字尾縮寫
⠐⠝	name	點加字首

⠕ o		
⠐⠕	one	點加字首
⠐⠕⠋	oneself	字母縮寫

⠏ p		
⠏	people	單字縮寫
⠏⠙	paid	字母縮寫
⠏⠻⠉⠧	perceive	字母縮寫
⠏⠻⠉⠧⠛	perceiving	字母縮寫
⠏⠻⠓	perhaps	字母縮寫
⠐⠏	part	點加字首

⠟ q		
⠟	quite	單字縮寫
⠟⠅	quick	字母縮寫
⠐⠟	question	點加字首

⠗ r		
⠗	rather	單字縮寫
⠗⠉⠧	receive	字母縮寫
⠗⠉⠧⠛	receiving	字母縮寫
⠗⠚⠉	rejoice	字母縮寫
⠗⠚⠉⠛	rejoicing	字母縮寫
⠐⠗	right	點加字首

⠎ s		
⠎	so	單字縮寫
⠎⠙	said	字母縮寫
⠎⠡	such	字母縮寫
⠨⠎	less	字尾縮寫
⠰⠎	ness	字尾縮寫
⠸⠎	spirit	點加字首
⠐⠎	some	點加字首

⠞ t		
⠞	that	單字縮寫
⠞⠙	today	字母縮寫
⠞⠛⠗	together	字母縮寫
⠞⠍	tomorrow	字母縮寫
⠞⠝	tonight	字母縮寫
⠨⠞	ount	字尾縮寫
⠰⠞	ment	字尾縮寫
⠐⠞	time	點加字首

⠥ u		
⠥	us	單字縮寫
⠐⠥	under	點加字首
⠘⠥	upon	點加字首

⠺ w		
⠺	will	單字縮寫
⠺⠙	would	字母縮寫
⠸⠺	world	點加字首
⠐⠺	work	點加字首

⠽ y		
⠽	you	單字縮寫
⠽⠗	your	字母縮寫
⠽⠗⠋	yourself	字母縮寫
⠽⠗⠧⠎	yourselves	字母縮寫
⠐⠽	young	點加字首

⠮ the		
⠮	the	強勢縮寫
⠮⠍⠧⠎	themselves	字母縮寫
⠸⠮	their	點加字首
⠐⠮	there	點加字首
⠘⠮	these	點加字首

⠹ th		
⠹	th/this	強勢縮寫
⠹⠽⠋	thyself	字母縮寫
⠐⠹	through	點加字首
⠘⠹	those	點加字首

⠳ ou		
⠳	ou/out	強勢縮寫
⠳⠗⠧⠎	ourselves	字母縮寫
⠐⠳	ought	點加字首

⠡ ch/child		
⠡	ch/child	強勢縮寫
⠡⠝	children	字母縮寫
⠐⠡	character	點加字首

⠱ wh		
⠱	wh/which	強勢縮寫
⠘⠱	whose	點加字首
⠐⠱	where	點加字首

⠩ sh		
⠩	sh/shall	強勢縮寫
⠩⠙	should	字母縮寫

其他 縮寫		
⠯	and	強勢縮寫
⠿	for	強勢縮寫
⠷	of	強勢縮寫
⠾	with	強勢縮寫
⠌	st/still	強勢縮寫
⠣	gh	強勢縮寫
⠪	ow	強勢縮寫
⠫	ed	強勢縮寫
⠻	er	強勢縮寫
⠬	ing	強勢縮寫
⠜	ar	強勢縮寫
⠚	just	單字縮寫
⠧	very	單字縮寫
⠵	as	單字縮寫
⠭	it	單字縮寫
⠂	ea	下位縮寫
⠴	was	下位縮寫
⠦	his	下位縮寫`;

        // 點字輸入相關變數
        let brailleMode = false;
        let dots = [0, 0, 0, 0, 0, 0];
        let brailleCode = 0;

        // 表格資料和排序相關變數
        let currentSort = { column: '', direction: 'asc' };
        const brailleData = processDataToCategories(rawData);

        // 初始化類別選單
        function initializeCategorySelect() {
            const select = document.getElementById('category-select');
            select.innerHTML = '<option value="">所有類別</option>';
            Object.entries(brailleData).forEach(([key, category]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = category.title;
                select.appendChild(option);
            });
        }

        // DOM 元素
        const searchInput = document.getElementById('search-input');
        const categorySelect = document.getElementById('category-select');
        const tableBody = document.getElementById('table-body');
        const modeIndicator = document.getElementById('mode-indicator');

        // 點字模式切換
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key.toLowerCase() === 'b') {
                e.preventDefault();
                brailleMode = !brailleMode;
                modeIndicator.textContent = brailleMode ? '點字模式' : '一般模式';
                modeIndicator.classList.toggle('mode-active', brailleMode);
                searchInput.placeholder = brailleMode ? 
                    "點字輸入模式 (SDF JKL)" : 
                    "搜尋點字符號、英文或類型...";
            }
        });


        // 點字輸入相關事件
        searchInput.addEventListener('keypress', function(e) {
            if (!brailleMode) return true;
            return keypressFunction(e);
        });

        searchInput.addEventListener('keydown', function(e) {
            if (!brailleMode) return true;
            return keydownFunction(e);
        });

        searchInput.addEventListener('keyup', function(e) {
            if (!brailleMode) return true;
            return keyupFunction(e, 'search-input');
        });

        // 搜尋與過濾功能
        searchInput.addEventListener('input', function() {
            if (!brailleMode) {
                updateTable();
            }
        });

        // 類別選擇事件
        categorySelect.addEventListener('change', updateTable);

        // 點字輸入功能實現
        function keypressFunction(event) {
            if ((event.keyCode == 37) || (event.keyCode == 39) || (event.keyCode == 8) || 
                (event.keyCode == 9) || (event.keyCode == 46) || (event.keyCode == 13) ||
                (event.keyCode == 59)) {
                if (event.keyCode == 13 || event.keyCode == 59) {
                    event.preventDefault();
                    return false;
                }
                return true;
            }
            event.preventDefault();
            return false;
        }

        function keydownFunction(event) {
            if (event.keyCode == 65) {
                var element = document.getElementById('search-input');
                var pos = element.selectionStart;
                if (pos > 0) {
                    var text = element.value;
                    element.value = text.slice(0, pos-1) + text.slice(pos);
                    setCaretPosition(element, pos-1);
                }
                return false;
            }
            
            if ((event.keyCode != 37) && (event.keyCode != 39) && (event.keyCode != 8) && 
                (event.keyCode != 9) && (event.keyCode != 46) && (event.keyCode != 13)) {
                if (event.keyCode == 83) {
                    dots[0] = 1;
                    brailleCode = brailleCode | 4;
                } else if (event.keyCode == 68) {
                    dots[1] = 1;
                    brailleCode = brailleCode | 2;
                } else if (event.keyCode == 70) {
                    dots[2] = 1;
                    brailleCode = brailleCode | 1;
                } else if (event.keyCode == 74) {
                    dots[3] = 1;
                    brailleCode = brailleCode | 8;
                } else if (event.keyCode == 75) {
                    dots[4] = 1;
                    brailleCode = brailleCode | 16;
                } else if (event.keyCode == 76) {
                    dots[5] = 1;
                    brailleCode = brailleCode | 32;
                } else if (event.keyCode == 32) {
                    brailleCode = 65;
                    return true;
                }
                return false;
            }
        }

        function keyupFunction(event, eb_tag) {
            for (i = 0; i < 6; i++) {
                dots[i] = 0;
            }
            if (brailleCode == 0) {
                return false;
            } else {
                if (brailleCode == 65) {
                    brailleCode = 0;
                }
                var element = document.getElementById(eb_tag);
                var sPos = element.selectionStart;
                var ePos = element.selectionEnd;
                var brl = String.fromCharCode(0x2800 + brailleCode);
                var a = element.value;
                var output = a.slice(0, sPos) + brl + a.slice(ePos);
                element.value = output;
                setCaretPosition(element, sPos + 1);
                updateTable();
            }
            brailleCode = 0;
            return false;
        }

        function setCaretPosition(ctrl, pos) {
            if (ctrl.setSelectionRange) {
                ctrl.focus();
                ctrl.setSelectionRange(pos, pos);
            }
        }

        // 排序與表格更新相關功能
        function initializeSortingEvents() {
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.sort;
                    if (currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'asc';
                    }
                    updateSortIcons();
                    updateTable();
                });
            });
        }

        function updateSortIcons() {
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.className = 'sort-icon';
            });
            if (currentSort.column) {
                const th = document.querySelector(`th[data-sort="${currentSort.column}"]`);
                const icon = th.querySelector('.sort-icon');
                icon.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }

		function updateTableHeader() {
			const thead = document.querySelector('table thead');
			thead.innerHTML = `
				<tr>
					${!categorySelect.value ? '<th data-sort="category">類別 <span class="sort-icon"></span></th>' : ''}
					<th data-sort="braille">點字符號 <span class="sort-icon"></span></th>
					<th data-sort="english">英文 <span class="sort-icon"></span></th>
					<th data-sort="type">類型 <span class="sort-icon"></span></th>
				</tr>
			`;
			initializeSortingEvents();
		}

        function updateTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categorySelect.value;
            let filteredData = [];
			updateTableHeader();
            if (selectedCategory) {
                filteredData = brailleData[selectedCategory].data.filter(item =>
                    matchSearchTerm(item, searchTerm)
                ).map(item => ({
                    ...item,
                    category: brailleData[selectedCategory].title
                }));
            } else {
                filteredData = Object.entries(brailleData).flatMap(([key, category]) =>
                    category.data.filter(item =>
                        matchSearchTerm(item, searchTerm)
                    ).map(item => ({
                        ...item,
                        category: category.title
                    }))
                );
            }

            if (currentSort.column) {
                filteredData.sort((a, b) => {
                    const aVal = (a[currentSort.column] || '').toString().toLowerCase();
                    const bVal = (b[currentSort.column] || '').toString().toLowerCase();
                    if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';

            if (filteredData.length === 0) {
                const noResultsRow = document.createElement('tr');
                const noResultsCell = document.createElement('td');
                noResultsCell.colSpan = selectedCategory ? 3 : 4;
                noResultsCell.className = 'no-results';
                noResultsCell.textContent = '找不到符合的結果';
                noResultsRow.appendChild(noResultsCell);
                tableBody.appendChild(noResultsRow);
                return;
            }

            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                if (!selectedCategory) {
                    const categoryCell = document.createElement('td');
                    categoryCell.textContent = item.category;
                    row.appendChild(categoryCell);
                }

                const brailleCell = document.createElement('td');
                brailleCell.textContent = item.braille;
                row.appendChild(brailleCell);

                const englishCell = document.createElement('td');
                englishCell.textContent = item.english;
                row.appendChild(englishCell);

                const typeCell = document.createElement('td');
                typeCell.textContent = item.type;
                row.appendChild(typeCell);

                tableBody.appendChild(row);
            });
        }

        function matchSearchTerm(item, searchTerm) {
            return !searchTerm || 
                   item.braille.toLowerCase().includes(searchTerm) ||
                   item.english.toLowerCase().includes(searchTerm) ||
                   item.type.toLowerCase().includes(searchTerm);
        }

        // 初始化
        initializeCategorySelect();
        initializeSortingEvents();
        updateTable();
		</script>
</body>
</html>