<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è§¸æ§é»å­—æ©Ÿ</title>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      overflow-x: hidden;
    }
    
    .container {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      text-align: center;
      padding: 10px;
      background-color: #2196F3;
      color: white;
    }
    
    .output-area {
      flex: 1;
      padding: 10px;
      background-color: white;
      border-bottom: 1px solid #ccc;
      position: relative;
    }
    
    .output-content {
      width: 100%;
      height: 100%;
      overflow-y: auto;
      padding: 12px;
      font-size: 20px;
      border: 1px solid #ddd;
      background-color: white;
      word-break: break-all;
      white-space: pre-wrap;
    }
    
    /* è¤‡è£½æŒ‰éˆ• */
    .copy-btn {
      position: absolute;
      right: 15px;
      bottom: 15px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 5;
      cursor: pointer;
    }
    
    .keyboard-area {
      height: 40vh;
      min-height: 250px;
      background-color: #333;
      position: relative;
      display: flex;
      flex-direction: column;
      touch-action: manipulation;
    }
    
    .braille-preview {
      height: 60px;
      background-color: #222;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
    }
    
    @media screen and (orientation: portrait) {
      .braille-preview {
        height: 40px;
      }
      
      .keyboard-area {
        height: 35vh;
        min-height: 220px;
      }
    }
    
    .keyboard {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      padding: 10px;
    }
    
    .key-row {
      display: flex;
      width: 100%;
      justify-content: space-around;
      height: 70px;
    }
    
    .key {
      background-color: #444;
      color: white;
      border-radius: 10px;
      border: 2px solid #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      user-select: none;
      width: 10%;
      height: 100%;
      min-width: 60px;
      position: relative;
      box-shadow: 0 4px 0 #222;
      transition: transform 0.05s, box-shadow 0.05s;
      margin: 0 5px;
    }
    
    .key.pressed {
      background-color: #555;
      transform: translateY(4px);
      box-shadow: 0 0 0 #222;
    }
    
    .key .dot-position {
      position: absolute;
      bottom: 5px;
      right: 5px;
      font-size: 14px;
      color: #aaa;
    }
    
    .key-semicolon {
      background-color: #4CAF50;
    }
    
    .control-buttons {
      display: flex;
      height: 60px;
      background-color: #222;
      width: 100%;
    }
    
    .control-btn {
      flex: 1;
      border: none;
      background-color: #333;
      color: white;
      font-size: 18px;
      border-right: 1px solid #444;
    }
    
    .control-btn:last-child {
      border-right: none;
    }
    
    .control-btn.space {
      flex: 2;
      background-color: #555;
    }
    
    .instructions {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      z-index: 100;
      opacity: 0.8;
      max-width: 250px;
    }
    
    .instructions h3 {
      margin-top: 0;
    }
    
    .instructions p {
      margin: 5px 0;
    }
    
    .instructions-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0,0,0,0.5);
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 101;
    }

    @media screen and (max-width: 768px) {
      .key {
        min-width: 30px;
        font-size: 18px;
        margin: 0 2px;
      }
      
      .key-row {
        height: 60px;
      }
      
      .braille-preview {
        height: 50px;
      }
      
      .control-buttons {
        height: 50px;
      }
      
      .control-btn {
        font-size: 16px;
      }
      
      .header h2 {
        font-size: 20px;
        margin: 5px 0;
      }
    }
    
    @media screen and (max-width: 480px) {
      .key {
        min-width: 20px;
        font-size: 16px;
        margin: 0 1px;
      }
      
      .key .dot-position {
        font-size: 10px;
      }
      
      .key-row {
        height: 50px;
      }
      
      .braille-preview {
        height: 40px;
      }
      
      .control-buttons {
        height: 40px;
      }
      
      .control-btn {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>è§¸æ§é»å­—æ©Ÿ</h2>
    </div>
    
    <div class="output-area">
      <div id="output-text" class="output-content" contenteditable="false"></div>
      <button class="copy-btn" id="copy-btn" title="è¤‡è£½åˆ°å‰ªè²¼ç°¿">ğŸ“‹</button>
    </div>
    
    <div class="keyboard-area">
      <div class="braille-preview" id="braille-preview"></div>
      
      <div class="keyboard">
        <div class="key-row">
          <div class="key" id="key-a" data-index="6">
            A
            <span class="dot-position">é€€æ ¼</span>
          </div>
          <div class="key" id="key-s" data-index="2">
            S
            <span class="dot-position">3</span>
          </div>
          <div class="key" id="key-d" data-index="1">
            D
            <span class="dot-position">2</span>
          </div>
          <div class="key" id="key-f" data-index="0">
            F
            <span class="dot-position">1</span>
          </div>
          <div class="key" id="key-j" data-index="3">
            J
            <span class="dot-position">4</span>
          </div>
          <div class="key" id="key-k" data-index="4">
            K
            <span class="dot-position">5</span>
          </div>
          <div class="key" id="key-l" data-index="5">
            L
            <span class="dot-position">6</span>
          </div>
          <div class="key key-semicolon" id="key-semicolon" data-index="7">
            ;
            <span class="dot-position">æ›è¡Œ</span>
          </div>
        </div>
      </div>
      
      <div class="control-buttons">
        <button class="control-btn" id="clear-btn">æ¸…é™¤</button>
        <button class="control-btn space" id="space-btn">ç©ºæ ¼</button>
        <button class="control-btn" id="enter-btn">æ›è¡Œ</button>
      </div>
    </div>
    
    <div class="instructions-toggle" id="instructions-toggle">?</div>
    <div class="instructions" id="instructions" style="display: none;">
      <h3>ä½¿ç”¨èªªæ˜ï¼š</h3>
      <p>1. åŒæ™‚æŒ‰ä¸‹ä¸åŒæŒ‰éµçµ„åˆè¼¸å…¥é»å­—</p>
      <p>2. F=é»1, D=é»2, S=é»3</p>
      <p>3. J=é»4, K=é»5, L=é»6</p>
      <p>4. A=é€€æ ¼, ;=æ›è¡Œ</p>
      <p>5. ç¤ºä¾‹: FSKçµ„åˆè¼¸å…¥â •</p>
      <p>6. ä¹Ÿå¯ä½¿ç”¨éµç›¤è¼¸å…¥</p>
    </div>
  </div>

  <script>
    // é»å­—è¨˜éŒ„è®Šæ•¸
    let dots = [0, 0, 0, 0, 0, 0];
    let brailleCode = 0;
    let activeKeys = new Set();
    let touches = {};
    
    // DOM å…ƒç´ åƒè€ƒ
    const keys = document.querySelectorAll('.key');
    const outputText = document.getElementById('output-text');
    const braillePreview = document.getElementById('braille-preview');
    const clearBtn = document.getElementById('clear-btn');
    const spaceBtn = document.getElementById('space-btn');
    const enterBtn = document.getElementById('enter-btn');
    const instructionsToggle = document.getElementById('instructions-toggle');
    const instructions = document.getElementById('instructions');
    
    // é¡¯ç¤º/éš±è—èªªæ˜
    instructionsToggle.addEventListener('click', function() {
      if (instructions.style.display === 'none') {
        instructions.style.display = 'block';
      } else {
        instructions.style.display = 'none';
      }
    });
    
    // åªå°éµç›¤å€åŸŸç›£è½è§¸æ§äº‹ä»¶
    const keyboardArea = document.querySelector('.keyboard-area');
    keyboardArea.addEventListener('touchstart', handleTouchStart, { passive: false });
    keyboardArea.addEventListener('touchmove', handleTouchMove, { passive: false });
    keyboardArea.addEventListener('touchend', handleTouchEnd, { passive: false });
    
    // è™•ç†è§¸æ§å–æ¶ˆ
    keyboardArea.addEventListener('touchcancel', function(e) {
      // é‡‹æ”¾æ‰€æœ‰æŒ‰éµ
      for (const touchId in touches) {
        const touchInfo = touches[touchId];
        if (touchInfo && touchInfo.element) {
          handleKeyRelease(touchInfo.element);
        }
      }
      
      // æ¸…ç©ºè§¸æ§è¨˜éŒ„
      touches = {};
      
      // å¦‚æœæœ‰æ´»å‹•é»å­—ï¼Œè€ƒæ…®æäº¤
      if (brailleCode !== 0) {
        commitBraille();
      }
    }, { passive: false });
    
    // ä¹Ÿæ”¯æ´æ»‘é¼ äº‹ä»¶ï¼ˆç”¨æ–¼é–‹ç™¼æ¸¬è©¦ï¼‰
    keys.forEach(key => {
      key.addEventListener('mousedown', function(e) {
        handleKeyPress(this);
      });
      
      key.addEventListener('mouseup', function(e) {
        handleKeyRelease(this);
      });
      
      // é˜²æ­¢æ»‘é¼ é›¢é–‹æŒ‰éµæ™‚æ²’æœ‰è§¸ç™¼ mouseup
      key.addEventListener('mouseleave', function(e) {
        if (this.classList.contains('pressed')) {
          handleKeyRelease(this);
        }
      });
    });
    
    // å…¨åŸŸç›£è½ç©ºæ ¼éµï¼Œé˜²æ­¢é é¢æ»¾å‹•
    document.addEventListener('keydown', function(e) {
      // å¦‚æœæ˜¯ç©ºæ ¼éµ
      if (e.key === ' ' || e.keyCode === 32) {
        // é˜»æ­¢é»˜èªè¡Œç‚ºï¼ˆé é¢æ»¾å‹•ï¼‰
        e.preventDefault();
        
        // å¦‚æœç„¦é»ä¸åœ¨è¼¸å‡ºå€åŸŸï¼Œå‰‡æ·»åŠ ç©ºæ ¼åˆ°è¼¸å‡ºæ–‡æœ¬
        outputText.textContent += ' ';
        outputText.scrollTop = outputText.scrollHeight;
        return false;
      }
    }, false);
    
    // è™•ç†æŒ‰éµæŒ‰ä¸‹
    document.addEventListener('keydown', function(e) {
      // é˜²æ­¢é‡è¤‡è§¸ç™¼
      if (e.repeat) return;
      
      let keyElement;
      switch(e.key.toLowerCase()) {
        case 'a':
          keyElement = document.getElementById('key-a');
          break;
        case 's':
          keyElement = document.getElementById('key-s');
          break;
        case 'd':
          keyElement = document.getElementById('key-d');
          break;
        case 'f':
          keyElement = document.getElementById('key-f');
          break;
        case 'j':
          keyElement = document.getElementById('key-j');
          break;
        case 'k':
          keyElement = document.getElementById('key-k');
          break;
        case 'l':
          keyElement = document.getElementById('key-l');
          break;
        case ';':
          keyElement = document.getElementById('key-semicolon');
          break;
        case 'backspace':
          const text = outputText.textContent;
          if (text.length > 0) {
            outputText.textContent = text.slice(0, -1);
          }
          e.preventDefault();
          return;
        case 'enter':
          outputText.textContent += '\n';
          outputText.scrollTop = outputText.scrollHeight;
          e.preventDefault();
          return;
      }
      
      if (keyElement) {
        handleKeyPress(keyElement);
        e.preventDefault();
      }
    });
    
    document.addEventListener('keyup', function(e) {
      let keyElement;
      switch(e.key.toLowerCase()) {
        case 'a':
          keyElement = document.getElementById('key-a');
          break;
        case 's':
          keyElement = document.getElementById('key-s');
          break;
        case 'd':
          keyElement = document.getElementById('key-d');
          break;
        case 'f':
          keyElement = document.getElementById('key-f');
          break;
        case 'j':
          keyElement = document.getElementById('key-j');
          break;
        case 'k':
          keyElement = document.getElementById('key-k');
          break;
        case 'l':
          keyElement = document.getElementById('key-l');
          break;
        case ';':
          keyElement = document.getElementById('key-semicolon');
          break;
      }
      
      if (keyElement) {
        handleKeyRelease(keyElement);
        e.preventDefault();
      }
    });
    
    // æ§åˆ¶æŒ‰éˆ•äº‹ä»¶
    clearBtn.addEventListener('click', function() {
      outputText.textContent = '';
    });
    
    spaceBtn.addEventListener('click', function() {
      outputText.textContent += ' ';
      // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
      outputText.scrollTop = outputText.scrollHeight;
    });
    
    enterBtn.addEventListener('click', function() {
      outputText.textContent += '\n';
      // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
      outputText.scrollTop = outputText.scrollHeight;
    });
    
    // è¤‡è£½æŒ‰éˆ•åŠŸèƒ½
    document.getElementById('copy-btn').addEventListener('click', function() {
      const text = outputText.textContent;
      if (text.length > 0) {
        navigator.clipboard.writeText(text).then(function() {
          alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(function(err) {
          console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
        });
      }
    });
    
    // è™•ç†è§¸æ§é–‹å§‹
    function handleTouchStart(e) {
      // è¨˜éŒ„è§¸æ§é»
      for (let i = 0; i < e.changedTouches.length; i++) {
        const touch = e.changedTouches[i];
        const element = document.elementFromPoint(touch.clientX, touch.clientY);
        
        if (element && element.classList.contains('key')) {
          // è¨˜éŒ„é€™å€‹è§¸æ§é»å°æ‡‰çš„å…ƒç´ 
          touches[touch.identifier] = {
            element: element,
            x: touch.clientX,
            y: touch.clientY
          };
          
          // è™•ç†æŒ‰éµæŒ‰ä¸‹
          handleKeyPress(element);
        }
      }
      
      // é˜²æ­¢é»˜èªè¡Œç‚ºï¼ˆå¦‚æœæœ‰æŒ‰éµè¢«æŒ‰ä¸‹ï¼‰
      if (Object.keys(touches).length > 0) {
        e.preventDefault();
      }
    }
    
    // è™•ç†è§¸æ§ç§»å‹•
    function handleTouchMove(e) {
      for (let i = 0; i < e.changedTouches.length; i++) {
        const touch = e.changedTouches[i];
        const touchInfo = touches[touch.identifier];
        
        // å¦‚æœé€™å€‹è§¸æ§é»ä¹‹å‰åœ¨æŒ‰éµä¸Š
        if (touchInfo && touchInfo.element) {
          const newElement = document.elementFromPoint(touch.clientX, touch.clientY);
          
          // å¦‚æœç§»å‹•åˆ°äº†ä¸åŒå…ƒç´ 
          if (newElement !== touchInfo.element) {
            // é‡‹æ”¾èˆŠæŒ‰éµ
            handleKeyRelease(touchInfo.element);
            
            // å¦‚æœç§»å‹•åˆ°äº†æ–°æŒ‰éµï¼ŒæŒ‰ä¸‹å®ƒ
            if (newElement && newElement.classList.contains('key')) {
              handleKeyPress(newElement);
              touches[touch.identifier] = {
                element: newElement,
                x: touch.clientX,
                y: touch.clientY
              };
            } else {
              // ä¸å†æ˜¯æŒ‰éµï¼Œç§»é™¤æ­¤è§¸æ§é»è¨˜éŒ„
              delete touches[touch.identifier];
            }
          } else {
            // æ›´æ–°è§¸æ§é»ä½ç½®
            touchInfo.x = touch.clientX;
            touchInfo.y = touch.clientY;
          }
        }
      }
      
      // é˜²æ­¢é»˜èªè¡Œç‚ºï¼ˆå¦‚æœæœ‰æŒ‰éµè¢«æŒ‰ä¸‹ï¼‰
      if (Object.keys(touches).length > 0) {
        e.preventDefault();
      }
    }
    
    // è™•ç†è§¸æ§çµæŸ
    function handleTouchEnd(e) {
      for (let i = 0; i < e.changedTouches.length; i++) {
        const touch = e.changedTouches[i];
        const touchInfo = touches[touch.identifier];
        
        // å¦‚æœé€™å€‹è§¸æ§é»æœ‰å°æ‡‰çš„å…ƒç´ ï¼Œé‡‹æ”¾å®ƒ
        if (touchInfo && touchInfo.element) {
          handleKeyRelease(touchInfo.element);
        }
        
        // ç§»é™¤æ­¤è§¸æ§é»è¨˜éŒ„
        delete touches[touch.identifier];
      }
      
      // å¦‚æœæ²’æœ‰æ›´å¤šçš„è§¸æ§é»ä¸”æœ‰æ´»å‹•é»å­—ï¼Œå¯ä»¥è€ƒæ…®æäº¤
      if (Object.keys(touches).length === 0 && brailleCode !== 0) {
        // æª¢æŸ¥æ˜¯å¦æœ‰åŠŸèƒ½éµè¢«æŒ‰ä¸‹
        let anyFunctionKeyPressed = false;
        if (activeKeys.has(6) || activeKeys.has(7)) {
          anyFunctionKeyPressed = true;
        }
        
        if (!anyFunctionKeyPressed) {
          commitBraille();
        }
      }
      
      // é˜²æ­¢è§¸æ§çµæŸçš„é»˜èªè¡Œç‚º
      e.preventDefault();
    }
    
    // è™•ç†æŒ‰éµæŒ‰ä¸‹
    function handleKeyPress(keyElement) {
      if (keyElement.classList.contains('pressed')) {
        return;
      }
      
      keyElement.classList.add('pressed');
      const index = parseInt(keyElement.dataset.index);
      activeKeys.add(index);
      
      // è™•ç†é»ä½
      if (index >= 0 && index <= 5) {
        dots[index] = 1;
        
        // æ ¹æ“šé»ä½è¨­ç½® brailleCode
        if (index === 0) brailleCode |= 1; // F é»1
        else if (index === 1) brailleCode |= 2; // D é»2
        else if (index === 2) brailleCode |= 4; // S é»3
        else if (index === 3) brailleCode |= 8; // J é»4
        else if (index === 4) brailleCode |= 16; // K é»5
        else if (index === 5) brailleCode |= 32; // L é»6
        
        updateBraillePreview();
      }
    }
    
    // è™•ç†æŒ‰éµé‡‹æ”¾
    function handleKeyRelease(keyElement) {
      keyElement.classList.remove('pressed');
      const index = parseInt(keyElement.dataset.index);
      activeKeys.delete(index);
      
      // ç‰¹æ®ŠåŠŸèƒ½éµ
      if (index === 6) { // A éµ - é€€æ ¼
        const text = outputText.textContent;
        if (text.length > 0) {
          outputText.textContent = text.slice(0, -1);
        }
        resetDots();
        return;
      } else if (index === 7) { // åˆ†è™Ÿéµ - Enter
        outputText.textContent += '\n';
        // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
        outputText.scrollTop = outputText.scrollHeight;
        resetDots();
        return;
      }
      
      // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é»å­—éµéƒ½å·²é‡‹æ”¾
      let anyPointKeyActive = false;
      for (let i = 0; i <= 5; i++) {
        if (activeKeys.has(i)) {
          anyPointKeyActive = true;
          break;
        }
      }
      
      // å¦‚æœæ²’æœ‰é»å­—éµè¢«æŒ‰ä¸‹ï¼Œä¸”æœ‰é»å­—ä»£ç¢¼ï¼Œå‰‡è¼¸å…¥é»å­—
      if (!anyPointKeyActive && brailleCode !== 0) {
        commitBraille();
      }
    }
    
    // æ·»åŠ èª¿è©¦é¡¯ç¤º
    function updateBraillePreview() {
      if (brailleCode === 0) {
        braillePreview.textContent = '';
      } else {
        const brailleChar = String.fromCharCode(0x2800 + brailleCode);
        let activeDots = [];
        for (let i = 0; i < 6; i++) {
          if (dots[i] === 1) {
            activeDots.push(i+1);
          }
        }
        braillePreview.textContent = brailleChar + ' (' + activeDots.join(',') + ')';
      }
    }
    
    // è¼¸å…¥é»å­—
    function commitBraille() {
      if (brailleCode !== 0) {
        const brailleChar = String.fromCharCode(0x2800 + brailleCode);
        outputText.textContent += brailleChar;
        resetDots();
        
        // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
        outputText.scrollTop = outputText.scrollHeight;
      }
    }
    
    // é‡ç½®é»ä½ç‹€æ…‹
    function resetDots() {
      dots = [0, 0, 0, 0, 0, 0];
      brailleCode = 0;
      updateBraillePreview();
    }
    
    // é¡¯ç¤ºåˆå§‹èªªæ˜
    window.addEventListener('load', function() {
      setTimeout(function() {
        instructions.style.display = 'block';
        setTimeout(function() {
          instructions.style.display = 'none';
        }, 5000);
      }, 1000);
    });
  </script>
</body>
</html>